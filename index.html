<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Game H·ª©ng L√¨ X√¨ 2026 - Music Update</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        :root {
            --game-width: 100vw;
            --game-height: 100vh;
            --max-width: 500px;
            --item-size: 55px;
            --player-width: 75px; 
            --player-height: 60px;
        }

        * { box-sizing: border-box; touch-action: none; margin: 0; padding: 0; }

        body {
            background: #1a1a1a;
            font-family: 'Segoe UI', Arial, sans-serif;
            display: flex; justify-content: center; align-items: center;
            height: 90vh; overflow: hidden;
        }

        /* --- BACKGROUND MENU (Repo gametet) --- */
        #menu {
            position: fixed; inset: 0;
            background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), 
                        url("https://raw.githubusercontent.com/NightMare411/gametet/main/nenmenu.jpeg") center/cover no-repeat;
            color: white; display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 100; text-align: center; padding: 20px;
        }

        /* --- BACKGROUND GAME (Repo gametet) --- */
        #game-wrapper {
            width: var(--game-width); 
            max-width: var(--max-width);
            height: var(--game-height); 
            position: relative;
            background: url("https://raw.githubusercontent.com/NightMare411/gametet/main/hinhnen.jpg") center/cover no-repeat;
            background-color: #fff; overflow: hidden;
            box-shadow: 0 0 100px rgba(0,0,0,0.5);
        }

        #gameover {
            position: absolute; inset: 0;
            background: rgba(0,0,0,0.92);
            color: white; display: none; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 110; text-align: center; padding: 30px;
            backdrop-filter: blur(10px);
        }

        #result-img {
            width: 80%; max-width: 250px;
            height: auto; max-height: 30vh;
            object-fit: contain; margin-bottom: 20px;
            border-radius: 15px;
        }

        .lane-line {
            position: absolute; top: 0; bottom: 0; width: 1px;
            background: rgba(255,255,255,0.1); border-left: 1px dashed rgba(255,215,0,0.3);
        }

        /* --- PLAYER (Repo tet2026) --- */
        #player {
            position: absolute; bottom: 30px;
            width: var(--player-width); height: var(--player-height);
            background: url("https://raw.githubusercontent.com/NightMare411/tet2026/main/player.png") center/contain no-repeat;
            transition: left 0.08s ease-out;
            z-index: 10;
        }

        .item {
            position: absolute; width: var(--item-size); height: var(--item-size);
            background-size: contain; background-repeat: no-repeat;
            background-position: center; will-change: transform;
            top: 0; border-radius: 20px;
        }

        .item-good { border: 2px solid #00ff00; box-shadow: 0 0 10px #00ff00; }
        .item-bad { border: 2px solid #ff4500; box-shadow: 0 0 10px #ff4500; }
        .item-fatal { border: 2px solid #8a2be2; box-shadow: 0 0 15px #8a2be2; }

        #ui-layer { position: absolute; top: 20px; left: 20px; z-index: 50; }
        #score-display {
            font-size: 1.1em; font-weight: bold; color: #b30000;
            background: rgba(255,255,255,0.9); padding: 10px 20px;
            border-radius: 50px; border: 2px solid #ffd700;
        }

        button {
            background: linear-gradient(180deg, #ffd700, #ff8c00);
            color: #b30000; border: none; padding: 15px 40px;
            font-size: 1.2rem; border-radius: 50px; cursor: pointer;
            font-weight: bold; margin-top: 20px;
        }
    </style>
</head>
<body>

<audio id="bgMusic" loop>
    <source src="https://raw.githubusercontent.com/NightMare411/gametet/main/nhacnen.mp3" type="audio/mpeg">
</audio>
<audio id="loseSound">
    <source src="https://raw.githubusercontent.com/NightMare411/gametet/main/nhacthua.mp3" type="audio/mpeg">
</audio>
<audio id="winSound">
    <source src="https://raw.githubusercontent.com/NightMare411/tet2026/main/langman.mp3" type="audio/mpeg">
</audio>


<div id="menu">
    <h1 style="color:#ffd700; font-size: 2.5rem; text-shadow: 2px 2px 5px #000;">üßß H·ª®NG L√å X√å 2026</h1>
    <p style="margin: 10px 0;">C√†ng nhi·ªÅu ti·ªÅn r∆°i c√†ng nhanh!</p>
    <button onclick="startGame()">V√ÄO CH∆†I</button>
</div>

<div id="game-wrapper" style="display:none;">
    <div class="lane-line" style="left: 33.33%;"></div>
    <div class="lane-line" style="left: 66.66%;"></div>
    <div id="ui-layer"><div id="score-display">Ti·ªÅn: 0ƒë</div></div>
    <div id="player"></div>

    <div id="gameover">
        <img id="result-img" src="" alt="K·∫øt qu·∫£">
        <h2 id="overTitle" style="font-size: 2rem;"></h2>
        <p id="finalScore" style="margin: 15px 0; white-space: pre-line;"></p>
        <button onclick="location.reload()">CH∆†I L·∫†I</button>
    </div>
</div>

<script>
    const REPO_ITEMS = "https://raw.githubusercontent.com/NightMare411/tet2026/main/";
    const REPO_ASSETS = "https://raw.githubusercontent.com/NightMare411/gametet/main/";

    const CONFIG = {
        WIN_SCORE: 10000000,
        MAX_SPEED_SCORE: 5000000,
        LANES: [0.166, 0.5, 0.833],
        IMG_WIN: REPO_ASSETS + "thang.jpg",
        IMG_LOSE: REPO_ASSETS + "thua.jpg",
        ITEMS: [
            { value: 50000, img: 'lixi.png', weight: 0.35 },
            { value: 500000, img: 'lixi500k.webp', weight: 0.1 },
            { value: 200000, img: '200k.jpeg', weight: 0.1 },
            { value: 2000, img: 'lixi2k.webp', weight: 0.05 },
            { value: -200000, img: 'doilixi.webp', weight: 0.15 },
            { value: -300000, img: 'mattien.jpeg', weight: 0.15 },
            { value: NaN, img: 'baitap.webp', weight: 0.1 }
        ]
    };

    let state = { score: 0, lane: 1, alive: false, fallTime: 5.0 };
    const player = document.getElementById('player');
    const wrapper = document.getElementById('game-wrapper');
    const scoreText = document.getElementById('score-display');
    const bgMusic = document.getElementById('bgMusic');
    const loseSound = document.getElementById('loseSound');
    const winSound = document.getElementById('winSound');

    function updatePlayerPos() {
        const w = wrapper.offsetWidth;
        player.style.left = (CONFIG.LANES[state.lane] * w - player.offsetWidth / 2) + 'px';
    }

    wrapper.addEventListener('pointerdown', e => {
        if (!state.alive) return;
        const rect = wrapper.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        if (clickX < wrapper.offsetWidth / 2) state.lane = Math.max(0, state.lane - 1);
        else state.lane = Math.min(2, state.lane + 1);
        updatePlayerPos();
    });

    document.addEventListener('keydown', e => {
        if (!state.alive) return;
        if (e.key === 'ArrowLeft') state.lane = Math.max(0, state.lane - 1);
        if (e.key === 'ArrowRight') state.lane = Math.min(2, state.lane + 1);
        updatePlayerPos();
    });

    function startGame() {
        document.getElementById('menu').style.display = 'none';
        wrapper.style.display = 'block';
        state.alive = true;
        bgMusic.volume = 0.5;
        bgMusic.play().catch(() => {});
        updatePlayerPos();
        spawnLogic();
    }

    function spawnLogic() {
        if (!state.alive) return;
        let ratio = Math.min(Math.max(state.score, 0) / CONFIG.MAX_SPEED_SCORE, 1);
        state.fallTime = 5.0 - (ratio * 3.5);
        createItem(state.fallTime);
        let spawnDelay = 850 - (ratio * 550);
        setTimeout(spawnLogic, spawnDelay);
    }

    function createItem(currentFallTime) {
        const rand = Math.random();
        let cumulativeWeight = 0;
        let itemCfg = CONFIG.ITEMS[0];
        for (const item of CONFIG.ITEMS) {
            cumulativeWeight += item.weight;
            if (rand < cumulativeWeight) { itemCfg = item; break; }
        }

        const el = document.createElement('div');
        const typeClass = isNaN(itemCfg.value) ? 'item-fatal' : (itemCfg.value < 0 ? 'item-bad' : 'item-good');
        el.className = `item ${typeClass}`;
        
        const laneIdx = Math.floor(Math.random() * 3);
        const w = wrapper.offsetWidth;
        const h = wrapper.offsetHeight;
        
        el.style.backgroundImage = `url("${REPO_ITEMS + itemCfg.img}")`;
        el.style.left = (CONFIG.LANES[laneIdx] * w - 27.5) + 'px'; 
        wrapper.appendChild(el);

        let currentY = -100; 
        const animate = () => {
            if (!state.alive) { el.remove(); return; }
            currentY += h / (currentFallTime * 60);
            el.style.transform = `translateY(${currentY}px)`;
            const playerTop = h - 115;
            const itemBottom = currentY + 55;

            if (laneIdx === state.lane && itemBottom > playerTop + 20 && currentY < h - 45) {
                handleCollect(itemCfg);
                el.remove();
                return;
            }
            if (currentY < h + 100) requestAnimationFrame(animate);
            else el.remove();
        };
        requestAnimationFrame(animate);
    }

    function handleCollect(cfg) {
        if (isNaN(cfg.value)) {
            endGame("LOSE", "D√çNH B√ÄI T·∫¨P R·ªíI!\nPh·∫£i chƒÉm h·ªçc th√¥i...");
            return;
        }
        state.score += cfg.value;
        scoreText.innerText = `Ti·ªÅn: ${state.score.toLocaleString()}ƒë`;
        if (state.score >= CONFIG.WIN_SCORE) endGame("WIN", "CHI·∫æN TH·∫ÆNG!");
        else if (state.score < 0) endGame("LOSE", "PH√Å S·∫¢N R·ªíI!");
    }

    function endGame(type, msg) {
        state.alive = false;
        bgMusic.pause();
        
        // CH√àN NH·∫†C TH·∫ÆNG / THUA
        if (type === "WIN") {
            winSound.play();
        } else {
            loseSound.play();
        }

        const over = document.getElementById('gameover');
        over.style.display = 'flex';
        document.getElementById('result-img').src = (type === "WIN" ? CONFIG.IMG_WIN : CONFIG.IMG_LOSE);
        document.getElementById('overTitle').innerText = (type === "WIN" ? "CHI·∫æN TH·∫ÆNG!" : "TH·∫§T B·∫†I!");
        document.getElementById('finalScore').innerText = `${msg}\nT·ªïng l·ªôc: ${state.score.toLocaleString()}ƒë`;
    }

    window.addEventListener('resize', updatePlayerPos);
</script>
</body>
</html>
